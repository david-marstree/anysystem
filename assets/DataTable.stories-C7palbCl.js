import{j as a}from"./jsx-runtime-BjG_zV1W.js";import{R as m,r as L}from"./iframe-gIK4bdEr.js";import{_ as p,u as q,a as I,b as R,c as B,d as $,e as P}from"./lodash-CKelhqjC.js";import{C as F}from"./CheckboxBase-Cdt_LvxH.js";import{A as O,a as K}from"./index-BQ1ygiz2.js";import{t as j}from"./bundle-mjs-3VKOpVsw.js";import{o as H,f as M,s as U,a as W}from"./floating-ui.react-dom-DpUDME4m.js";import{M as G,U as X,G as z,V as Y}from"./listbox-czf6WRC6.js";import{X as J}from"./transition-BSBR0-FO.js";import{u as Q}from"./useLocalStorage-D7b6dMIa.js";import"./preload-helper-C1FmrZbK.js";import"./keyboard-ea4pcW4v.js";import"./index-BPuoX7PR.js";import"./iconBase-zb0yOOdI.js";import"./bugs-DbHXcW6g.js";import"./use-resolve-button-type-CGEIKNbq.js";import"./use-by-comparator-CZU-NL2p.js";import"./label-CKvBRiA1.js";import"./description-Bx7Nq89P.js";import"./portal-DJ8oPe_c.js";import"./focus-management-Ddlno2iB.js";import"./open-closed-D6AVR6gh.js";const f=m.createContext({selectable:!1,chooseFieldable:!1,fields:[],state:{DTChecked:[],DTData:[],DTShowFields:[]},dispatch:()=>{}}),x=({children:e,value:r})=>a.jsx(f.Provider,{value:r,children:e});try{f.displayName="DataTableContext",f.__docgenInfo={description:"",displayName:"DataTableContext",props:{}}}catch{}try{x.displayName="DataTableProvider",x.__docgenInfo={description:"",displayName:"DataTableProvider",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"DataTableContextType<DataType>"}}}}}catch{}const D=({field:e})=>a.jsx("th",{children:e.label});try{D.displayName="DataTableHeadCell",D.__docgenInfo={description:"",displayName:"DataTableHeadCell",props:{field:{defaultValue:null,description:"",name:"field",required:!0,type:{name:"DataTableField<DataType>"}}}}}catch{}const Z=()=>{const{fields:e,selectable:r,state:t,dispatch:l}=m.useContext(f),n=m.useMemo(()=>e.filter(s=>t.DTShowFields.includes(s.key)),[e,t.DTShowFields]);return a.jsx("thead",{children:a.jsxs("tr",{children:[r&&a.jsx("th",{className:"w-8 p-2",children:a.jsx(F,{checked:t.DTChecked.every(s=>s===!0),intermediate:t.DTChecked.some(s=>s===!0)&&!t.DTChecked.every(s=>s===!0),onChange:()=>l({type:"SELECT_ALL"})})}),n.map((s,y)=>a.jsx(D,{field:s},y))]})})},ee=e=>e.startsWith("$"),w=(e,r)=>{if(!p.isPlainObject(e)&&!p.isArray(e))return e;if(typeof r=="function")return r(e);if(!ee(r))return r;const t=r.replace(/^\$\./,"").split(".").reduce((l,n)=>{var s;return!p.isPlainObject(l.data)&&!p.isArray(l.data)?{...l,key:""}:p.isArray(l.data)?{...l,isArray:!0,key:l.key+"."+n}:n==="@"?{...l,key:"$",isArray:!1}:{...l,data:(s=l==null?void 0:l.data)==null?void 0:s[n]}},{data:e,isArray:!1,key:""});return t.isArray===!0?p.map(t.data,l=>w(l,t.key)):t.data},T=({children:e,data:r,field:t})=>{if(e)return a.jsx("td",{children:e});if(typeof r!="object"||!t)return a.jsx("td",{});const l=w(r,t);return l?p.isArray(l)?a.jsx("td",{children:l.join(",")}):a.jsx("td",{children:l}):a.jsx("td",{})};try{T.displayName="DataTableCell",T.__docgenInfo={description:"",displayName:"DataTableCell",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"object"}},field:{defaultValue:null,description:"",name:"field",required:!1,type:{name:"string | ValueNode<DataType>"}}}}}catch{}const g=({row:e,children:r,index:t})=>{const{selectable:l,fields:n,state:s,dispatch:y}=m.useContext(f);return a.jsxs("tr",{children:[l&&a.jsx("td",{className:"w-[50px]",children:a.jsx(F,{checked:!!s.DTChecked[t],onChange:()=>y({type:"SELECT_ROW",index:t})})}),r||(p.isPlainObject(e)?n.filter(d=>s.DTShowFields.includes(d.key)).map((d,u)=>a.jsx(T,{data:e,field:d.value},u)):a.jsx(a.Fragment,{}))]})};try{g.displayName="DataTableRow",g.__docgenInfo={description:"",displayName:"DataTableRow",props:{row:{defaultValue:null,description:"",name:"row",required:!1,type:{name:"object"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}}}}}catch{}const ae=()=>{const{state:e}=m.useContext(f);return a.jsx("tbody",{children:e.DTData&&e.DTData.map((r,t)=>a.jsx(g,{row:r,index:t},t))})},te=()=>{const{fields:e,state:r,dispatch:t}=m.useContext(f),{refs:l,x:n,y:s,strategy:y,floatingStyles:d,context:u}=q({open:!0,middleware:[H(10),M(),U()],whileElementsMounted:W}),i=I(u,{move:!1}),N=R(u),S=B(u),E=$(u,{role:"tooltip"}),{getReferenceProps:A,getFloatingProps:V}=P([i,N,S,E]);return a.jsxs(G,{as:"div",className:"absolute top-2 right-2",value:e.filter(c=>r.DTShowFields.includes(c.key)),multiple:!0,onChange:c=>{const h=c.map(o=>o.key);t({type:"SET_FIELD",fields:c.length===0?e.every(o=>!(o!=null&&o.default))?e:e.filter(o=>!!(o!=null&&o.default)):e.filter(o=>h.includes(o.key))})},ref:l.setReference,...A(),children:[a.jsx(X,{className:"inline-flex justify-between !p-0 focus:outline-none",children:a.jsx(O,{className:"w-5 h-5 text-gray-400 cursor-pointer","aria-hidden":"true"})}),a.jsx(J,{as:L.Fragment,enter:"transition duration-100 ease-out",enterFrom:"scale-95 transform opacity-0",enterTo:"scale-100 transform opacity-100",leave:"transition duration-75 ease-in",leaveFrom:"scale-100 transform opacity-100",leaveTo:"scale-95 transform opacity-0",children:a.jsx(z,{anchor:"bottom",className:"z-[999] mt-2 inline-block w-48 origin-top-right divide-y divide-gray-100 dark:divide-gray-700 rounded-md bg-white dark:bg-gray-950 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none",ref:l.setFloating,style:d,...V({style:{position:y,top:s??"",left:n??""}}),children:a.jsx("div",{className:"flex flex-col px-1 py-1",children:e.map(c=>{var h;return a.jsx(Y,{className:j("relative flex justify-between px-3 py-2 text-black dark:text-white cursor-pointer select-none hover:bg-primary-100 dark:hover:bg-primary-900"),value:c,children:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"pl-6",children:c.label}),((h=r.DTShowFields)==null?void 0:h.includes(c.key))&&a.jsx("span",{className:j("absolute inset-y-0 left-0 flex items-center pl-3 text-primary-600"),children:a.jsx(K,{className:"w-5 h-4","aria-hidden":"true"})})]})},c.key)})})})})]})},re=(e,r)=>r.type==="SELECT_ALL"?{...e,DTChecked:e.DTChecked.every(t=>t===!0)?e.DTChecked.map(()=>!1):e.DTChecked.map(()=>!0)}:r.type==="SELECT_ROW"?{...e,DTChecked:e.DTChecked.map((t,l)=>l===r.index?!t:t)}:r.type==="SELECT_FIELDKEY"?{...e,DTShowFields:e.DTShowFields.includes(r.fieldKey)?e.DTShowFields.filter(t=>t!==r.fieldKey):p.uniq([...e.DTShowFields,r.fieldKey])}:r.type==="SET_FIELD"?{...e,DTShowFields:r.fields.map(t=>t.key)}:e,_=({name:e="",data:r,fields:t,selectable:l=!1,chooseFieldable:n=!1})=>{const[s,y]=Q(`tableName-path-${window.location.pathname.replace(/\//g,"-")}-name-${e}`,t.every(i=>!(i!=null&&i.default))?t.map(i=>i.key):t.filter(i=>i.default===!0).map(i=>i.key)),[d,u]=m.useReducer(re,{DTData:r,DTChecked:new Array(r.length).fill(!1),DTShowFields:s});return m.useEffect(()=>{y(d.DTShowFields)},[d.DTShowFields]),a.jsx(x,{value:{selectable:l,fields:t,chooseFieldable:n,state:d,dispatch:u},children:a.jsxs("div",{className:"relative w-full",children:[a.jsx(te,{}),a.jsxs("table",{className:"table",children:[a.jsx(Z,{}),a.jsx(ae,{})]})]})})};try{_.displayName="DataTable",_.__docgenInfo={description:"",displayName:"DataTable",props:{data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"DataType[]"}},fields:{defaultValue:null,description:"",name:"fields",required:!0,type:{name:"DataTableField<DataType>[]"}},selectable:{defaultValue:{value:"false"},description:"",name:"selectable",required:!1,type:{name:"boolean"}},chooseFieldable:{defaultValue:{value:"false"},description:"",name:"chooseFieldable",required:!1,type:{name:"boolean"}},name:{defaultValue:{value:""},description:"",name:"name",required:!1,type:{name:"string"}}}}}catch{}const ve={title:"Components/DataTable",component:_,tags:["autodocs"],argTypes:{name:{control:{type:"text"},description:"表格名稱（可選）"},data:{control:{type:"object"},description:"表格資料陣列，每一列為一個物件"},fields:{control:{type:"object"},description:"欄位定義陣列，描述每個欄位的 key、label 等"},selectable:{control:{type:"boolean"},description:"是否可勾選列（多選）"},chooseFieldable:{control:{type:"boolean"},description:"是否允許用戶自訂顯示哪些欄位"}}},b={args:{name:"user-table",data:[{id:1,name:"Alice",age:25},{id:2,name:"Bob",age:30},{id:3,name:"Charlie",age:22}],fields:[{key:"id",label:"ID",value:"$.id"},{key:"name",label:"姓名",value:"$.name"},{key:"age",label:"年齡",value:"$.age"}],selectable:!0,chooseFieldable:!0}};var k,C,v;b.parameters={...b.parameters,docs:{...(k=b.parameters)==null?void 0:k.docs,source:{originalSource:`{
  args: {
    name: "user-table",
    data: [{
      id: 1,
      name: "Alice",
      age: 25
    }, {
      id: 2,
      name: "Bob",
      age: 30
    }, {
      id: 3,
      name: "Charlie",
      age: 22
    }],
    fields: [{
      key: "id",
      label: "ID",
      value: "$.id"
    }, {
      key: "name",
      label: "姓名",
      value: "$.name"
    }, {
      key: "age",
      label: "年齡",
      value: "$.age"
    }],
    selectable: true,
    chooseFieldable: true
  }
}`,...(v=(C=b.parameters)==null?void 0:C.docs)==null?void 0:v.source}}};const Fe=["Basic"];export{b as Basic,Fe as __namedExportsOrder,ve as default};
