import{j as a}from"./jsx-runtime-DR9Q75dM.js";import{R as m,r as L}from"./index-DRjF_FHU.js";import{_ as p,h as q,i as R,k as $,m as P,n as H,o as O}from"./lodash-BHNxmqSH.js";import{C as N}from"./CheckboxBase-s0Y0UoHE.js";import{e as K,f as M}from"./index-BhDvn_Ny.js";import{t as C}from"./bundle-mjs-3VKOpVsw.js";import{o as U,f as W,s as G,a as X}from"./floating-ui.react-dom-C2h4aSh8.js";import{M as z,U as Y,G as J,V as Q}from"./listbox-DtdJMkht.js";import{X as Z}from"./transition-A3JfTXRq.js";import{u as ee}from"./useLocalStorage-B9lCm1sh.js";import"./open-closed-12XbF_VX.js";import"./index-CmHj60O0.js";import"./portal-BoPUeaCu.js";import"./iconBase-yPxZrzXe.js";import"./use-resolve-button-type-DRx0-JiP.js";const f=m.createContext({selectable:!1,chooseFieldable:!1,fields:[],state:{DTChecked:[],DTData:[],DTShowFields:[]},dispatch:()=>{}}),D=({children:e,value:r})=>a.jsx(f.Provider,{value:r,children:e});try{D.displayName="DataTableProvider",D.__docgenInfo={description:"",displayName:"DataTableProvider",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"DataTableContextType<DataType>"}}}}}catch{}const T=({field:e})=>a.jsx("th",{children:e.label});try{T.displayName="DataTableHeadCell",T.__docgenInfo={description:"",displayName:"DataTableHeadCell",props:{field:{defaultValue:null,description:"",name:"field",required:!0,type:{name:"DataTableField<DataType>"}}}}}catch{}const x=()=>{const{fields:e,selectable:r,state:t,dispatch:l}=m.useContext(f),n=m.useMemo(()=>e.filter(s=>t.DTShowFields.includes(s.key)),[e,t.DTShowFields]);return a.jsx("thead",{children:a.jsxs("tr",{children:[r&&a.jsx("th",{className:"w-8 p-2",children:a.jsx(N,{checked:t.DTChecked.every(s=>s===!0),intermediate:t.DTChecked.some(s=>s===!0)&&!t.DTChecked.every(s=>s===!0),onChange:()=>l({type:"SELECT_ALL"})})}),n.map((s,y)=>a.jsx(T,{field:s},y))]})})};try{x.displayName="DataTableHead",x.__docgenInfo={description:"",displayName:"DataTableHead",props:{}}}catch{}const ae=e=>e.startsWith("$"),S=(e,r)=>{if(!p.isPlainObject(e)&&!p.isArray(e))return e;if(typeof r=="function")return r(e);if(!ae(r))return r;const t=r.replace(/^\$\./,"").split(".").reduce((l,n)=>{var s;return!p.isPlainObject(l.data)&&!p.isArray(l.data)?{...l,key:""}:p.isArray(l.data)?{...l,isArray:!0,key:l.key+"."+n}:n==="@"?{...l,key:"$",isArray:!1}:{...l,data:(s=l==null?void 0:l.data)==null?void 0:s[n]}},{data:e,isArray:!1,key:""});return t.isArray===!0?p.map(t.data,l=>S(l,t.key)):t.data},_=({children:e,data:r,field:t})=>{if(e)return a.jsx("td",{children:e});if(typeof r!="object"||!t)return a.jsx("td",{});const l=S(r,t);return l?p.isArray(l)?a.jsx("td",{children:l.join(",")}):a.jsx("td",{children:l}):a.jsx("td",{})};try{_.displayName="DataTableCell",_.__docgenInfo={description:"",displayName:"DataTableCell",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"object"}},field:{defaultValue:null,description:"",name:"field",required:!1,type:{name:"string | ValueNode<DataType>"}}}}}catch{}const g=({row:e,children:r,index:t})=>{const{selectable:l,fields:n,state:s,dispatch:y}=m.useContext(f);return a.jsxs("tr",{children:[l&&a.jsx("td",{className:"w-[50px]",children:a.jsx(N,{checked:!!s.DTChecked[t],onChange:()=>y({type:"SELECT_ROW",index:t})})}),r||(p.isPlainObject(e)?n.filter(d=>s.DTShowFields.includes(d.key)).map((d,u)=>a.jsx(_,{data:e,field:d.value},u)):a.jsx(a.Fragment,{}))]})};try{g.displayName="DataTableRow",g.__docgenInfo={description:"",displayName:"DataTableRow",props:{row:{defaultValue:null,description:"",name:"row",required:!1,type:{name:"object"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}}}}}catch{}const j=()=>{const{state:e}=m.useContext(f);return a.jsx("tbody",{children:e.DTData&&e.DTData.map((r,t)=>a.jsx(g,{row:r,index:t},t))})};try{j.displayName="DataTableBody",j.__docgenInfo={description:"",displayName:"DataTableBody",props:{}}}catch{}const te=()=>{const{fields:e,state:r,dispatch:t}=m.useContext(f),{refs:l,x:n,y:s,strategy:y,floatingStyles:d,context:u}=q({open:!0,middleware:[U(10),W(),G()],whileElementsMounted:X}),i=R(u,{move:!1}),E=$(u),V=P(u),A=H(u,{role:"tooltip"}),{getReferenceProps:B,getFloatingProps:I}=O([i,E,V,A]);return a.jsxs(z,{as:"div",className:"absolute top-2 right-2",value:e.filter(c=>r.DTShowFields.includes(c.key)),multiple:!0,onChange:c=>{const h=c.map(o=>o.key);t({type:"SET_FIELD",fields:c.length===0?e.every(o=>!(o!=null&&o.default))?e:e.filter(o=>!!(o!=null&&o.default)):e.filter(o=>h.includes(o.key))})},ref:l.setReference,...B(),children:[a.jsx(Y,{className:"inline-flex justify-between !p-0 focus:outline-none",children:a.jsx(K,{className:"w-5 h-5 text-gray-400 cursor-pointer","aria-hidden":"true"})}),a.jsx(Z,{as:L.Fragment,enter:"transition duration-100 ease-out",enterFrom:"scale-95 transform opacity-0",enterTo:"scale-100 transform opacity-100",leave:"transition duration-75 ease-in",leaveFrom:"scale-100 transform opacity-100",leaveTo:"scale-95 transform opacity-0",children:a.jsx(J,{anchor:"bottom",className:"z-[999] mt-2 inline-block w-48 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",ref:l.setFloating,style:d,...I({style:{position:y,top:s??"",left:n??""}}),children:a.jsx("div",{className:"flex flex-col px-1 py-1",children:e.map(c=>{var h;return a.jsx(Q,{className:C("relative flex justify-between px-3 py-2 text-black cursor-pointer select-none hover:bg-primary-100"),value:c,children:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"pl-6",children:c.label}),((h=r.DTShowFields)==null?void 0:h.includes(c.key))&&a.jsx("span",{className:C("absolute inset-y-0 left-0 flex items-center pl-3 text-primary-600"),children:a.jsx(M,{className:"w-5 h-4","aria-hidden":"true"})})]})},c.key)})})})})]})},re=(e,r)=>r.type==="SELECT_ALL"?{...e,DTChecked:e.DTChecked.every(t=>t===!0)?e.DTChecked.map(()=>!1):e.DTChecked.map(()=>!0)}:r.type==="SELECT_ROW"?{...e,DTChecked:e.DTChecked.map((t,l)=>l===r.index?!t:t)}:r.type==="SELECT_FIELDKEY"?{...e,DTShowFields:e.DTShowFields.includes(r.fieldKey)?e.DTShowFields.filter(t=>t!==r.fieldKey):p.uniq([...e.DTShowFields,r.fieldKey])}:r.type==="SET_FIELD"?{...e,DTShowFields:r.fields.map(t=>t.key)}:e,k=({name:e="",data:r,fields:t,selectable:l=!1,chooseFieldable:n=!1})=>{const[s,y]=ee(`tableName-path-${window.location.pathname.replace(/\//g,"-")}-name-${e}`,t.every(i=>!(i!=null&&i.default))?t.map(i=>i.key):t.filter(i=>i.default===!0).map(i=>i.key)),[d,u]=m.useReducer(re,{DTData:r,DTChecked:new Array(r.length).fill(!1),DTShowFields:s});return m.useEffect(()=>{y(d.DTShowFields)},[d.DTShowFields]),a.jsx(D,{value:{selectable:l,fields:t,chooseFieldable:n,state:d,dispatch:u},children:a.jsxs("div",{className:"relative w-full",children:[a.jsx(te,{}),a.jsxs("table",{className:"table",children:[a.jsx(x,{}),a.jsx(j,{})]})]})})};try{k.displayName="DataTable",k.__docgenInfo={description:"",displayName:"DataTable",props:{data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"DataType[]"}},fields:{defaultValue:null,description:"",name:"fields",required:!0,type:{name:"DataTableField<DataType>[]"}},selectable:{defaultValue:{value:"false"},description:"",name:"selectable",required:!1,type:{name:"boolean"}},chooseFieldable:{defaultValue:{value:"false"},description:"",name:"chooseFieldable",required:!1,type:{name:"boolean"}},name:{defaultValue:{value:""},description:"",name:"name",required:!1,type:{name:"string"}}}}}catch{}const Te={title:"Components/DataTable",component:k,tags:["autodocs"],argTypes:{name:{control:{type:"text"},description:"表格名稱（可選）"},data:{control:{type:"object"},description:"表格資料陣列，每一列為一個物件"},fields:{control:{type:"object"},description:"欄位定義陣列，描述每個欄位的 key、label 等"},selectable:{control:{type:"boolean"},description:"是否可勾選列（多選）"},chooseFieldable:{control:{type:"boolean"},description:"是否允許用戶自訂顯示哪些欄位"}}},b={args:{name:"user-table",data:[{id:1,name:"Alice",age:25},{id:2,name:"Bob",age:30},{id:3,name:"Charlie",age:22}],fields:[{key:"id",label:"ID",value:"$.id"},{key:"name",label:"姓名",value:"$.name"},{key:"age",label:"年齡",value:"$.age"}],selectable:!0,chooseFieldable:!0}};var F,v,w;b.parameters={...b.parameters,docs:{...(F=b.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    name: "user-table",
    data: [{
      id: 1,
      name: "Alice",
      age: 25
    }, {
      id: 2,
      name: "Bob",
      age: 30
    }, {
      id: 3,
      name: "Charlie",
      age: 22
    }],
    fields: [{
      key: "id",
      label: "ID",
      value: "$.id"
    }, {
      key: "name",
      label: "姓名",
      value: "$.name"
    }, {
      key: "age",
      label: "年齡",
      value: "$.age"
    }],
    selectable: true,
    chooseFieldable: true
  }
}`,...(w=(v=b.parameters)==null?void 0:v.docs)==null?void 0:w.source}}};const xe=["Basic"];export{b as Basic,xe as __namedExportsOrder,Te as default};
